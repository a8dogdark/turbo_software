; SAVE#D:TENIS2.MAC
;	*=  $3000
	org $3000
BLKDOS
	.BY $55,$55
ORIGEN 	= $3000
PROGRAMA = $CC00
	TYA
	BPL BLKOK
	JSR $EDC7
	JMP $C8FC
BLKOK
	LDA EORBLOCK1
	EOR #$FF
	STA EORBLOCK1
	INC BLKOK+6
	INC BLKOK+1
	BNE NOICRHI
	INC BLKOK+7
	INC BLKOK+2
NOICRHI
	LDA BLKOK+2
	CMP # >FINBLKDOS
	BNE BLKOK
	LDA BLKOK+1
	CMP # <FINBLKDOS
	BNE BLKOK
EORBLOCK1
	LDA $E45A
	STA SALTO
	LDA $E45B
	STA SALTO+1
	LDA # <RAMPROG+SET
	STA $E45A
	STA ROM
	LDA # >RAMPROG+SET
	STA $E45B
	STA ROM+1
	LDA # <RAMPROG
	STA RAM
	LDA # >RAMPROG
	STA RAM+1
	LDY #0
	LDX #3
ARRIBAROM
	LDA (RAM),Y
	STA (ROM),Y
	INY
	BNE ARRIBAROM
	INC RAM+1
	INC ROM+1
	DEX
	BPL ARRIBAROM
	LDX #$02
LOOPINTERRUPCION
	LDA JSRINTERRUPCION,X
	STA $EB59,X
	LDA ERRORYA,X
	STA $EB1D,X
	DEX
	BPL LOOPINTERRUPCION
	STX $02DB
	STX $03F8
	STX $FE0D
	LDX $62
	LDA #$00
	STA $0480
	STA $0481
	STA $FE91,X
	LDA #$32
	STA $FE93,X
	LDA #$EA
	STA $EBF3
	STA $EBF4
	LDA #$C0
	STA $6A
	LDA #133
	STA $FE48
	LDA #12
	STA 764
	LDX #$40
	LDA #$0C
	STA $0342,X
	JSR $E456
	LDX #$40
	LDA #$03
	STA $0342,X
	LDA #$04
	STA $034A,X
	LDA #$80
	STA $034B,X
	LDA # <C
	STA $0344,X
	LDA # >C
	STA $0345,X
	JSR $E456
	LDX #$40
	LDA # <GAMEA+Z
	STA $0344,X
	LDA # >GAMEA+Z
	STA $0345,X
	LDA # <FIN-GAMEA
	STA $0348,X
	LDA # >FIN-GAMEA
	STA $0349,X
	LDA #$07
	STA $0342,X
	LDA #$F0
	STA QUEBLK+SET+1
	JSR $E456
	JMP GAMEA+Z
C
	.BY "C:",$9B
JSRINTERRUPCION
	JSR INTERRUPCION+SET
ERRORYA
	JSR ERROR?+SET
RAMPROG
	LDA $0300
	CMP #$60
	BNE READBLOCK
NEXT
	JSR READBLOCK+SET
	BMI ERROR
VUELTABLK1
	LDA $0480
	STA QUEBLK+SET
	LDA $0481
	STA QUEBLK+SET+1
	LDX #$02
COUNTBLOCK
	DEC BLK+SET,X
	LDA BLK+SET,X
	CMP #$8f	;'0-33
	BNE FINCOUNT
	LDA #$99	;'9-32
	STA BLK+SET,X
	DEX
	BPL COUNTBLOCK
FINCOUNT
	LDY #$01
	RTS
READBLOCK
	JMP (SALTO+SET)
ERROR?
	BEQ ERRORAZO
	LDY $30
	BMI ERRORAZO
	LDA $0317
	BEQ ERRORAZO
	RTS
ERRORAZO
	PLA
	PLA
ERROR
	JSR $EDC7
	CPY #136
	BNE NOESEOF
	TYA
	RTS
NOESEOF
	LDX #$0A
LOOPCORRIGIENDO
	LDA CORRECCION+SET,X
	STA LEYENDO+SET,X
	DEX
	BPL LOOPCORRIGIENDO
	CLC
	LDA 560
	STA $00
	LDA 561
	STA $01
	LDY #$0A
SAVEVIEJO
	LDA ($00),Y
	PHA
	INY
	CPY #$0D
	BNE SAVEVIEJO
JUSTO
	LDA $D40B
	BMI JUSTO
	LDY #$0A
	LDA #$01
	STA ($00),Y
	LDA 561
	CMP # >DISPLIST+SET
	BNE NOTENNIS
	LDA # <DL1+SET
	LDX # >DL1+SET
	BNE SITENNIS
NOTENNIS
	LDA # <DL2+SET
	LDX # >DL2+SET
SITENNIS
	INY
	STA ($00),Y
	TXA
	INY
	STA ($00),Y
	JSR $F2F8
JUSTO1
	LDA $D40B
	BMI JUSTO1
	LDY #$0C
RESTAURA
	PLA
	STA ($00),Y
	 DEY
	CPY #$09
	BNE RESTAURA
	LDA #$34
	STA $D302
	LDA $14
	CLC
	ADC #50
WMOTOR
	CMP $14
	BNE WMOTOR
ESPERE
	LDY $D40B
	LDX #$05
ESPERE1
	STX $D40A
ESIRG
	LDA $D20F
	AND #$10
	BEQ ESPERE
	CPY $D40B
	BNE ESIRG
	DEX
	BNE ESPERE1
NOESIGUAL
	LDA #$40
	STA $0303
	JSR READBLOCK+SET
	BPL NOERRORFALSO
	JSR $EDC7
	LDA #$34
	STA $D302
	BNE ESPERE
NOERRORFALSO
	LDA QUEBLK+SET+1
	BPL NOBLK1
	LDA $0480
	ORA $0481
	BNE VALLAERROR
	JSR CHANGEMSG+SET
CHANGEMSG
	JMP VUELTABLK1+SET
	LDX #$0A
LOOPLECTURA
	LDA LECTURA+SET,X
	STA LEYENDO+SET,X
	DEX
	BPL LOOPLECTURA
	LDY #$01
	RTS
NOBLK1
	LDX #$01
LOOPLUGAR
	LDA $0480,X
	CMP QUEBLK+SET,X
	BCC NOESIGUAL
	BNE VALLAERROR
	DEX
	BPL LOOPLUGAR
	JSR CHANGEMSG+SET
	JMP NEXT+SET
VALLAERROR
	JMP ERROR+SET
INTERRUPCION
	LDA LEYENDO+SET
	AND #$7F
	BEQ BYTESLOOP
	BNE NOES9I
BYTESLOOP
	LDX #$04
BYTESLOOP1
	INC BYTES+SET,X
	LDA BYTES+SET,X
	CMP #$9a	;'9-31
	BNE NOES9I
	LDA #$90	;'0-32
	STA BYTES+SET,X
	DEX
	BPL BYTESLOOP1
NOES9I
	LDA $D20D
	RTS
SALTO 	.DB 0
QUEBLK 	.DB 0,0,0
TENMEBLK
	.BY "000"
MENSAJEERROR
	.SB "   REBOBINE SU CASSETTE 3 VUELTAS DE    "
	.SB "   CONTADOR, PRESIONE  PLAY Y RETURN    "
PANTALLA
	.BY "********************"
PERS 	.SB "  "
NUMERO1 .SB "000"
		.SB "     * 1 JUGADOR-FRONTON *    "
NUMERO2 .SB "000  "
MENSAJE
		.SB "  MPM    * CARGANDO  PROGRAMA *    MPM  "
		.SB "  "
LEYENDO
		.SB " (R)-1988   BYTES:"
BYTES
		.SB "00000  BLOQUE:"
BLK
		.SB "000   "
		.BYTE "********************"
PER2
		.SB "  000     * 2 JUGADORES-TENIS *    000  "
PER1
		.SB "  000     * 1 JUGADOR-FRONTON *    000  "
CORRECCION
	.SB "CORRECCION"
LECTURA
	.SB " (R)-1988 "
CARGADO
	.SB "    PROGRAMA CARGADO, PRESIONE START    "
DL2
	.BY 64+2
	.WO MENSAJEERROR+SET
	.BY 2,65
	.WO $BC20
DL1
	.BY 64+2
	.WO MENSAJEERROR+SET
	.BY 2,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112
	.BY 64+2
	.WO MENSAJE+SET
	.BY 2,8,8
	.BY 65
	.WO DISPLIST+SET
DISPLIST
	.BY 64+8
	.WO PANTALLA+SET
	.BY 8,2,112,112,112,112,112,112,112
AQUIJUMP
	.BY 112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,112,0
	.BY 64+2
CUALPANTALLA
	.WO MENSAJE+SET
	.BY 2,8,8
	.BY 65
	.WO DISPLIST+SET
BUFFER
FINBLKDOS
;	*=  $4000
	org $4000
GAMEA
Z   =   $D800-org
	LDA # <GAME1A+Z
	STA $CB
	LDA # >GAME1A+Z
	STA $CC
	LDY #$00
EOR29LOOP
	LDA ($CB),Y
	EOR #$29
	STA ($CB),Y
	INC $CB
	BNE BCC
	INC $CC
BCC
	LDA $CC
	CMP # >FIN+Z
	BNE EOR29LOOP
	LDA $CB
	CMP # <FIN+Z
	BNE EOR29LOOP
GAME1A
	JMP COMIENZOLOAD+Z
SETCANT
	LDX #$10
	STA $0348,X
	TYA
	STA $0349,X
	RTS
READ2
	LDA #$02
	LDY #$00
	JSR SETCANT+Z
READ3
	LDA # <FIN+Z
	LDY # >FIN+Z
SETPOS
	STA $0344,X
	TYA
	STA $0345,X
	LDA #$07
	STA $0342,X
	JSR $E456
	BPL NOEOF
	JMP INICIOBOOT+Z
NOEOF
	LDX #$10
	RTS
BYTELENTO .BY $00
LEEMULA
	LDA #$01
	STA BYTELENTO+Z
LEEMULA1
	LDA $D20F
	AND #$10
	BEQ LEEMULA1
FINSTART
	LDA $D20F
	AND #$10
	BNE FINSTART
;   LDA #$00-12
	LDA #$00-10
	STA 20
ESPERO12
	LDA 20
	BNE ESPERO12
LEOBIT
	CLC
	LDA $D20F
	AND #$10
	BEQ LEICERO
	SEC
LEICERO
	ROL BYTELENTO+Z
	BCS FINBYTELENTO
;   LDA #$00-8
	LDA #$00-7
	STA 20
	BNE ESPERO12
FINBYTELENTO
	LDA BYTELENTO+Z
	RTS
COMIENZOLOAD
	LDY $D40B
	BMI COMIENZOLOAD
	LDA # <$E45F
	STA $0222
	LDA # >$E45F
	STA $0223
	LDA #$00
	STA $D200
	STA $D201
	STA $D202
BORRAMEM
	LDA #$04
	STA $01
	LDA #$00
	STA $00
	TAY
ERASERAM
	STA ($00),Y
	INY
	BNE ERASERAM
	INC $01
	LDX $01
PONERC0
	CPX #$C0
	BNE ERASERAM
	LDX #$02
ZLOOPCEROS
	LDA TENMEBLK+SET,X
	STA BLK+SET,X
	LDA #$90	;'0-32
	STA BYTES+2+SET,X
	DEX
	BPL ZLOOPCEROS
	STA BYTES+1+SET
	LDX #$03
	LDA #$00
NIRUNNISTART
	STA $02E0,X
	DEX
	BPL NIRUNNISTART
	STA FBOOT+Z
PMBASE = $DC
JOYST = $D300
BOTON1 = $D010
BOTON2 = $D011
COLORP0 = $02C0
HPOSP0 = $D000
HPOSP1 = $D001
HPOSP2 = $D002
DIVISION = $D007
CONSOL = $D01F
RANDOM = $D20A
BOLITA = PMBASE*$0100+768+16
P0  =   PMBASE*$0100+512+16
P1  =   PMBASE*$0100+640+16
INICIO
	LDY #17
	LDA #$EA
NOPDLIVBI
	STA $C137,Y
	DEY
	BPL NOPDLIVBI
	LDY #$02
NOSHADOWS
	STA $C16F,Y
	STA $C178,Y
	DEY
	BPL NOSHADOWS
	LDA #0
	STA START+Z
	LDX #$82
LOOPCLR
	STA BOLITA,X
	STA P0-2,X
	STA P1-2,X
	DEX
	CPX #$FF
	BNE LOOPCLR
	INX
LOOPCLR1
	STA $DE00,X
	STA $DF00,X
	DEX
	BNE LOOPCLR1
	LDA #191
	STA HPOSP0
	LDA #0
	STA HPOSP1
	LDA #191
	STA HPOSP2
	LDX #42
	STX $D004
	LDX #206
	STX $D005
	JSR SETPERS+Z
	LDA #63
	STA $D00C
	LDA #$03
	LDX YPOS0+Z
	LDY #$0C
DIBP1
	STA P0,X
	STA P1,X
	INX
	DEY
	BPL DIBP1
	LDA #1
	LDX YPOS2+Z
	STA BOLITA,X
WFORSET
	LDA $D40B
	BMI WFORSET
	LDA # <VBI+Z
	STA $0222
	LDA # >VBI+Z
	STA $0223
	JMP OPEN+Z
SETPERS
	LDA #2
	STA 623
	STA $D01D
	LDA #PMBASE
	STA $D407
	LDX #0
	STX DIVISION
	LDA #$7F
	STA $D011
	RTS
YPOS0 	.BY 48
YPOS1 	.BY 48
YPOS2 	.BY 48
XPOS2 	.BY 191
XPOS1 	.BY 0
FX  	.BY $FF
FY  	.BY 0
START 	.BY 0
IMPULSO .BY 0
SELECT 	.BY 0
JUEGO 	.BY $FF
SAVEVBI .DB 0
VBI
	LDA # >DISPLIST+SET
	STA $D403
	STA $0244
	STA 561
	LDA # <DISPLIST+SET
	STA $D402
	STA 560
	LDA #0
	STA 77
	STA $D018
	LDA #$E0
	STA $D409
	LDA #$0E
	STA $D012
	STA $D013
	STA $D014
	STA $D016
	STA $D017
	STA $D019
	LDA #212
	STA $D01A
	LDA #42
	STA $D400
	LDA #$A0
	STA $D201
	LDA #$00
	STA $D200
	LDA CONSOL
	CMP #$05
	BNE SELECT0
	LDA SELECT+Z
	BNE NOCAMBIO
	LDA #1
	STA SELECT+Z
	LDA #0
	STA START+Z
	LDY #39
	LDA JUEGO+Z
	EOR #$FF
	STA JUEGO+Z
	BMI ESUNO
CHANGE ;        2 PERS
	LDA PER2+SET,Y
	STA PERS+SET,Y
	DEY
	BPL CHANGE
	LDA #50
	STA HPOSP1
	STA XPOS1+Z
	LDA #127
	STA DIVISION
	BNE TERMINELO
ESUNO ;         1PER
	LDA PER1+SET,Y
	STA PERS+SET,Y
	DEY
	BPL ESUNO
	LDA #0
	STA HPOSP1
	STA XPOS1+Z
	STA DIVISION
TERMINELO
	JMP $E45F
SELECT0
	LDA #0
	STA SELECT+Z
NOCAMBIO
	LDA START+Z
	BNE STARTED
	LDA #0
	LDX YPOS2+Z
	STA BOLITA,X
	LDA CONSOL
	CMP #$06
	BNE NOSTART
	LDA #$FF
	STA START+Z
NOSTART
	LDA XPOS2+Z
	BPL BOTON2?
	LDA BOTON1
	BNE JOY
	LDA YPOS0+Z
	STA YPOS2+Z
	LDA #190
	STA XPOS2+Z
EMPIEZELO
	LDA #$FF
	STA START+Z
	BNE TERMINELO
BOTON2?
	LDA BOTON2
	BNE JOY
	LDA YPOS1+Z
6770     STA YPOS2+Z
6780     LDA #51
6790     STA XPOS2+Z
6800     BNE EMPIEZELO
6810 JOY
6820     JMP JOYSTS+Z
6830 STARTED
6840     LDA FX+Z
6850     BPL INCRX
6860     JSR DECREX+Z
6870     JMP UD+Z
6880 INCRX
6890     JSR INCREX+Z
6900 UD
6910     LDA #0
6920     LDX YPOS2+Z
6930     STA BOLITA,X
6940     LDA FY+Z
6950     BPL INCRY
6960     JSR DECREY+Z
6970     JMP JOYSTS+Z
6980 INCRY
6990     JSR INCREY+Z
7000     JMP JOYSTS+Z
7010 DECREX
7020     LDA $D00E
7030     AND #$02
7040     BEQ NOREBOTE
7050     LDA #$33
7060     STA $D200
7070     LDA #$AC
7080     STA $D201
7090     LDA JOYST
7100     LSR A
7110     LSR A
7120     LSR A
7130     LSR A
7140     CMP #$0F
7150     BEQ NOIMPULSE1
7160     LDA #$FF
7170 NOIMPULSE1
7180     STA IMPULSO+Z
7190     LDX XPOS2+Z
7200     JMP CHANGEXF+Z
7210 NOREBOTE
7220     DEC XPOS2+Z
7230     DEC XPOS2+Z
7240     LDX XPOS2+Z
7250     CPX #45
7260     BCS FINDECREX
7270     LDA XPOS1+Z
7280     CMP #40
7290     BCC OUT2
7300     LDA #0
7310     STA START+Z
7320 OUT2
7330     LDA #$88
7340     STA $D200
7350     LDA #$AC
7360     STA $D201
7370     LDY #2
7380 ZERO1
7390     LDA NUMERO1+SET,Y
7400     CMP #'9-32+128
7410     BEQ NINE1
7420     CLC
7430     ADC #1
7440     STA NUMERO1+SET,Y
7450     BNE CHANGEXF
7460 NINE1
7470     LDA #'0+128-32
7480     STA NUMERO1+SET,Y
7490     DEY
7500     BPL ZERO1
7510 CHANGEXF
7520     LDA FX+Z
7530     EOR #$FF
7540     STA FX+Z
7550 FINDECREX
7560     STX XPOS2+Z
7570     STX HPOSP2
7580     RTS
7590 INCREX
7600     LDA $D00E
7610     AND #$01
7620     BEQ NOREBOTE1
7630     LDA #$AC
7640     STA $D201
7650     LDA #$33
7660     STA $D200
7670     LDA JOYST
7680     AND #$0F
7690     CMP #$0F
7700     BEQ NOIMPULSE
7710     LDA #$FF
7720 NOIMPULSE
7730     STA IMPULSO+Z
7740     LDX XPOS2+Z
7750     JMP CHANGEXF+Z
7760 NOREBOTE1
7770     INC XPOS2+Z
7780     INC XPOS2+Z
7790     LDX XPOS2+Z
7800     CPX #205
7810     BCC FINDECREX
7820 SELEFUE
7830     LDA #0
7840     STA START+Z
7850     LDA #$88
7860     STA $D200
7870     LDA #$AC
7880     STA $D201
7890     LDY #2
7900 ZERO2
7910     LDA NUMERO2+SET,Y
7920     CMP #'9-32+128
7930     BEQ NINE2
7940     CLC
7950     ADC #1
7960     STA NUMERO2+SET,Y
7970     BNE CHANGEXF
7980 NINE2
7990     LDA #'0+128-32
8000     STA NUMERO2+SET,Y
8010     DEY
8020     BPL ZERO2
8030     BMI CHANGEXF
8040 INCREY
8050     INC YPOS2+Z
8060     LDA IMPULSO+Z
8070     BPL BOTAR1
8080     INC YPOS2+Z
8090 BOTAR1
8100     LDX YPOS2+Z
8110     CPX #92
8120     BCC FININCRY
8130 CHANGEFY
8140     LDA FY+Z
8150     EOR #$FF
8160     STA FY+Z
8170     LDA #$50
8180     STA $D200
8190     LDA #$AC
8200     STA $D201
8210 FININCRY
8220     LDA #1
8230     STA BOLITA,X
8240     RTS
8250 DECREY
8260     DEC YPOS2+Z
8270     LDA IMPULSO+Z
8280     BPL BOTAR2
8290     DEC YPOS2+Z
8300 BOTAR2
8310     LDX YPOS2+Z
8320     BMI CHANGEFY
8330     BPL FININCRY
8340 JOYSTS
8350     LDA #0
8360     STA $D01E
8370     LDA JOYST
8380     AND #$0F
8390     CMP #15
8400     BEQ JOY2
8410     CMP #14
8420     BNE DWN1
8430     JSR J1UP+Z
8440     JMP JOY2+Z
8450 DWN1
8460     CMP #13
8470     BNE JOY2
8480     JSR J1DWN+Z
8490 JOY2
8500     LDA JOYST
8510     LSR A
8520     LSR A
8530     LSR A
8540     LSR A
8550     CMP #15
8560     BEQ EXIT
8570     CMP #14
8580     BNE DWN2
8590     JSR J2UP+Z
8600     JMP $E45F
8610 DWN2
8620     CMP #13
8630     BNE EXIT
8640     JSR J2DWN+Z
8650 EXIT
8660     JMP $E45F
8670 J1UP
8680     LDY YPOS0+Z
8690     BEQ FINJ1UP
8700     LDX #16
8710 LOOPJ1UP
8720     LDA P0,Y
8730     STA P0-2,Y
8740     INY
8750     DEX
8760     BPL LOOPJ1UP
8770     DEC YPOS0+Z
8780     DEC YPOS0+Z
8790 FINJ1UP
8800     RTS
8810 J2UP
8820     LDY YPOS1+Z
8830     BEQ FINJ2UP
8840     LDX #16
8850 LOOPJ2UP
8860     LDA P1,Y
8870     STA P1-2,Y
8880     INY
8890     DEX
8900     BPL LOOPJ2UP
8910     DEC YPOS1+Z
8920     DEC YPOS1+Z
8930 FINJ2UP
8940     RTS
8950 J1DWN
8960     LDY YPOS0+Z
8970     CPY #80
8980     BEQ FINJ1DWN
8990     TYA
9000     CLC
9010     ADC #14
9020     TAY
9030     LDX #16
9040 LOOPJ1DWN
9050     LDA P0-2,Y
9060     STA P0,Y
9070     DEY
9080     DEX
9090     BPL LOOPJ1DWN
9100     INC YPOS0+Z
9110     INC YPOS0+Z
9120 FINJ1DWN
9130     RTS
9140 J2DWN
9150     LDY YPOS1+Z
9160     CPY #80
9170     BEQ FINJ2DWN
9180     TYA
9190     CLC
9200     ADC #14
9210     TAY
9220     LDX #16
9230 LOOPJ2DWN
9240     LDA P1-2,Y
9250     STA P1,Y
9260     DEY
9270     DEX
9280     BPL LOOPJ2DWN
9290     INC YPOS1+Z
9300     INC YPOS1+Z
9310 FINJ2DWN
9320     RTS
9330 OPEN
9340     LDA #$FF
9350     STA $0340
9360     LDX #$10
9370     LDA #$03
9380     STA $0342,X
9390     LDA # <DEVICE+Z
9400     STA $0344,X
9410     LDA # >DEVICE+Z
9420     STA $0345,X
9430     LDA #$04
9440     STA $034A,X
9450     LDA #$80
9460     STA $034B,X
9470     LDA #$0C
9480     STA 764
9490     JSR $E456
9500 ZREAD
9510     JSR READ2+Z
9520     LDA FIN+Z
9530     AND FIN+1+Z
9540     CMP #$FF
9550     BNE SERABOOT?
9560     LDA # <$E474-1
9570     STA $0C
9580     LDA # >$E474-1
9590     STA $0D
9600     LDA #$01
9610     STA FBOOT+Z
9620     BNE ZREAD
9630 SERABOOT?
9640     LDA $02E0
9650     ORA $02E1
9660     BNE RUNOK
9670     LDA FIN+Z
9680     STA $02E0
9690     LDA FIN+1+Z
9700     STA $02E1
9710 RUNOK
9720     LDA FBOOT+Z
9730     BNE NOESBOOT
9740     JMP ESBOOT+Z
9750 NOESBOOT
9760     LDA FIN+Z
9770     STA $0240
9780     LDA FIN+1+Z
9790     STA $0241
9800     JSR READ2+Z
9810     SEC
9820     LDA FIN+Z
9830     SBC $0240
9840     STA $0348,X
9850     LDA FIN+1+Z
9860     SBC $0241
9870     STA $0349,X
9880     INC $0348,X
9890     BNE NOCARRYY
9900     INC $0349,X
9910 NOCARRYY
9920     LDA $0240
9930     LDY $0241
9940     JSR SETPOS+Z
9950     LDA $02E2
9960     ORA $02E3
9970     BEQ NOSUBRUTIN
9980 CONSUBRUTINA
9990     JSR USERSUB+Z
010000   LDA #$00
010010   STA $02E2
010020   STA $02E3
010030 NOSUBRUTIN
010040   JMP ZREAD+Z
010050 USERSUB
010060   JMP ($02E2)
010070 CORREPROGRAMA
010080   LDA #$FF
010090   STA $D301
010100   JMP ($02E0)
010110 INICIOBOOT
010120   LDA #$00-30
010130   STA 20
010140 WRELOS
010150   LDA $D20F
010160   AND #$10
010170   BEQ INICIOBOOT
010180   LDA 20
010190   BNE WRELOS
010200   LDY #$02
010210 LEOLENTO
010220   JSR LEEMULA+Z
010230   STA $03E0,Y
010240   DEY
010250   BPL LEOLENTO
010260   LDA $03E0
010270   CMP $03E2
010280   BEQ JUSTOAHORA
010290   CMP $03E1
010300   BEQ JUSTOAHORA
010310   LDA $03E2
010320   CMP $03E1
010330   BEQ JUSTOAHORA
010340 LEYODISTINTO
010350   LDA #$03
010360   STA PONERC0+Z+1
010370   JMP BORRAMEM+Z
010380 JUSTOAHORA
010390   LDA #$3C
010400   STA $D302
010410   LDX #39
010420 PROGRAMAENMEMORIA
010430   LDA CARGADO+SET,X
010440   STA MENSAJE+SET,X
010450   DEX
010460   BPL PROGRAMAENMEMORIA
010470 PRESIONOCAMBIO?
010480   LDA CONSOL
010490   CMP #$06
010500   BNE PRESIONOCAMBIO?
010501 PRESIONOCAMBIO?2
010502   LDA CONSOL
010503   CMP #$07
010504   BNE PRESIONOCAMBIO?2
010505 ; SUELTA START ANTES DE EMPEZAR
010506 ;
010507 ;
010508 ;
010509 ;
010510   LDX #$07
010520 LLEVARAM
010530   LDA CORREPROGRAMA+Z,X
010540   STA $0392,X
010550   DEX
010560   BPL LLEVARAM
010570 JUSTO2
010580   LDA $D40B
010590   BMI JUSTO2
010600   LDA # <$E45F
010610   STA $0222
010620   LDA # >$E45F
010630   STA $0223
010640   LDA #$00
010650   STA 623
010660   LDX #$1F
010670 PMARGEN
010680   STA $D000,X
010690   DEX
010700   BPL PMARGEN
010710   LDA #$00
010720   STA $0244
010730   LDA #$02
010740   STA $09
010750   LDA $02E0
010760   STA $02
010770   STA $0A
010780   LDA $02E1
010790   STA $03
010800   STA $0B
010810   LDA $0D
010820   PHA
010830   LDA $0C
010840   PHA
010850 SINRESET
010860   JMP $0392
010870 ESBOOT
010880   LDA FIN+Z
010890   STA $0240
010900   LDA FIN+1+Z
010910   STA $0241
010920   JSR READ2+Z
010930   CLC
010940   LDA FIN+Z
010950   ADC #$06
010960   STA $04
010970   LDA FIN+1+Z
010980   ADC #$00
010990   STA $05
011000   JSR READ2+Z
011010   LDA FIN+Z
011020   STA $0C
011030   LDA FIN+1+Z
011040   STA $0D
011050   LDY #$06
011060 MULTIPLICA
011070   ASL $0241
011080   ROL $0240
011090   DEY
011100   BPL MULTIPLICA
011110   LDA $0240
011120   STA $0349,X
011130   LDA $0241
011140   STA $0348,X
011150   LDA $04
011160   STA $0344,X
011170   STA $02E0
011180   LDA $05
011190   STA $0345,X
011200   STA $02E1
011210   LDA #$07
011220   STA $0342,X
011230   JSR $E456
011240   SEC
011250   LDA $0C
011260   SBC #$01
011270   STA $0C
011280   LDA $0D
011290   SBC #$00
011300   STA $0D
011310   JMP INICIOBOOT+Z
011320 FBOOT
011330   .BYTE 0
011340 DEVICE
011350   .BYTE "C:",$9B
011360 FIN
011370   .END
